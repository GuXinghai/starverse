import { render, RenderOptions } from '@testing-library/vue'
import { expect } from 'vitest'

/**
 * 自定义渲染函数,自动注入全局配置
 */
export function renderWithProviders(
  component: any,
  options?: RenderOptions
) {
  return render(component, {
    ...options,
    global: {
      ...options?.global,
      // 在这里可以添加全局插件、指令等
      stubs: {
        teleport: true,
        ...options?.global?.stubs
      }
    }
  })
}

/**
 * 无障碍性测试工具 (简化版,不依赖 jest-axe)
 * 检查基本的 ARIA 属性
 */
export function checkBasicAccessibility(container: HTMLElement) {
  // 检查所有按钮是否有可访问的名称
  const buttons = container.querySelectorAll('button')
  buttons.forEach(button => {
    const hasAccessibleName = 
      button.textContent?.trim() || 
      button.getAttribute('aria-label') ||
      button.getAttribute('aria-labelledby')
    
    if (!hasAccessibleName) {
      console.warn('Button without accessible name:', button)
    }
  })

  // 检查所有图片是否有 alt 属性
  const images = container.querySelectorAll('img')
  images.forEach(img => {
    if (!img.getAttribute('alt') && img.getAttribute('role') !== 'presentation') {
      console.warn('Image without alt attribute:', img)
    }
  })

  // 检查表单元素是否有标签
  const inputs = container.querySelectorAll('input, textarea, select')
  inputs.forEach(input => {
    const id = input.getAttribute('id')
    const hasLabel = id && container.querySelector(`label[for="${id}"]`)
    const hasAriaLabel = input.getAttribute('aria-label') || input.getAttribute('aria-labelledby')
    
    if (!hasLabel && !hasAriaLabel) {
      console.warn('Form element without label:', input)
    }
  })
}
