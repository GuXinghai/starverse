import { describe, it, expect } from 'vitest'
import { render, screen } from '@testing-library/vue'
import userEvent from '@testing-library/user-event'
import IconButton from './IconButton.vue'

describe('IconButton', () => {
  describe('Rendering', () => {
    it('renders with icon and text', () => {
      render(IconButton, {
        props: {
          icon: 'üöÄ'
        },
        slots: {
          default: 'Launch'
        }
      })
      
      const button = screen.getByRole('button', { name: /Launch/i })
      expect(button).toBeInTheDocument()
      expect(button).toHaveTextContent('üöÄ')
    })

    it('renders with icon slot', () => {
      const { container } = render(IconButton, {
        slots: {
          default: 'Custom Button'
        }
      })
      
      // È™åËØÅÊåâÈíÆÊ∏≤Êüì
      const button = screen.getByRole('button')
      expect(button).toBeInTheDocument()
      expect(button).toHaveTextContent('Custom Button')
    })

    it('renders without text when no default slot', () => {
      render(IconButton, {
        props: {
          icon: '‚öôÔ∏è'
        }
      })
      
      const button = screen.getByRole('button')
      expect(button).toBeInTheDocument()
      expect(button).toHaveTextContent('‚öôÔ∏è')
    })
  })

  describe('Icon Position', () => {
    it('renders icon on left by default', () => {
      const { container } = render(IconButton, {
        props: {
          icon: 'üëà'
        },
        slots: {
          default: 'Text'
        }
      })
      
      const iconWrapper = container.querySelector('.icon-wrapper')
      const button = screen.getByRole('button')
      expect(iconWrapper).toHaveTextContent('üëà')
      expect(button).toHaveTextContent('Text')
    })

    it('renders icon on right when specified', () => {
      const { container } = render(IconButton, {
        props: {
          icon: 'üëâ',
          iconPosition: 'right'
        },
        slots: {
          default: 'Text'
        }
      })
      
      const iconWrapper = container.querySelector('.icon-wrapper')
      const button = screen.getByRole('button')
      expect(iconWrapper).toHaveTextContent('üëâ')
      expect(button).toHaveTextContent('Text')
    })
  })

  describe('Icon Only Mode', () => {
    it('hides text visually but keeps for accessibility', () => {
      render(IconButton, {
        props: {
          icon: '‚úì',
          iconOnly: true
        },
        slots: {
          default: 'Confirm'
        }
      })
      
      const button = screen.getByRole('button')
      expect(button).toBeInTheDocument()
      expect(button).toHaveTextContent('Confirm')
      
      const textSpan = button.querySelector('.sr-only')
      expect(textSpan).toBeInTheDocument()
      expect(textSpan).toHaveTextContent('Confirm')
    })

    it('applies icon-only-btn class in icon only mode', () => {
      render(IconButton, {
        props: {
          icon: '‚úì',
          iconOnly: true
        },
        slots: {
          default: 'Confirm'
        }
      })
      
      const button = screen.getByRole('button')
      expect(button).toHaveClass('icon-only-btn')
    })
  })

  describe('Inherited Props', () => {
    it('inherits variant prop from BaseButton', () => {
      render(IconButton, {
        props: {
          icon: 'üé®',
          variant: 'secondary'
        },
        slots: {
          default: 'Style'
        }
      })
      
      const button = screen.getByRole('button')
      expect(button).toHaveClass('bg-secondary-600')
    })

    it('inherits size prop from BaseButton', () => {
      render(IconButton, {
        props: {
          icon: 'üìè',
          size: 'lg'
        },
        slots: {
          default: 'Large'
        }
      })
      
      const button = screen.getByRole('button')
      expect(button).toHaveClass('px-6', 'py-3', 'text-lg')
    })

    it('inherits disabled prop from BaseButton', () => {
      render(IconButton, {
        props: {
          icon: 'üö´',
          disabled: true
        },
        slots: {
          default: 'Disabled'
        }
      })
      
      const button = screen.getByRole('button')
      expect(button).toBeDisabled()
    })

    it('inherits loading prop from BaseButton', () => {
      render(IconButton, {
        props: {
          icon: '‚è≥',
          loading: true
        },
        slots: {
          default: 'Loading'
        }
      })
      
      const button = screen.getByRole('button')
      expect(button).toHaveAttribute('aria-busy', 'true')
    })
  })

  describe('Events', () => {
    it('emits click event when clicked', async () => {
      const user = userEvent.setup()
      let clickCount = 0
      
      render(IconButton, {
        props: {
          icon: 'üëÜ',
          onClick: () => clickCount++
        },
        slots: {
          default: 'Click'
        }
      })
      
      const button = screen.getByRole('button')
      await user.click(button)
      
      expect(clickCount).toBe(1)
    })
  })

  describe('Icon Sizes', () => {
    it('applies correct icon size for xs', () => {
      const { container } = render(IconButton, {
        props: {
          icon: 'üîç',
          size: 'xs'
        }
      })
      
      const iconWrapper = container.querySelector('.icon-wrapper')
      expect(iconWrapper).toHaveClass('text-xs')
    })

    it('applies correct icon size for sm', () => {
      const { container } = render(IconButton, {
        props: {
          icon: 'üîç',
          size: 'sm'
        }
      })
      
      const iconWrapper = container.querySelector('.icon-wrapper')
      expect(iconWrapper).toHaveClass('text-sm')
    })

    it('applies correct icon size for md (default)', () => {
      const { container } = render(IconButton, {
        props: {
          icon: 'üîç'
        }
      })
      
      const iconWrapper = container.querySelector('.icon-wrapper')
      expect(iconWrapper).toHaveClass('text-base')
    })

    it('applies correct icon size for lg', () => {
      const { container } = render(IconButton, {
        props: {
          icon: 'üîç',
          size: 'lg'
        }
      })
      
      const iconWrapper = container.querySelector('.icon-wrapper')
      expect(iconWrapper).toHaveClass('text-lg')
    })

    it('applies correct icon size for xl', () => {
      const { container } = render(IconButton, {
        props: {
          icon: 'üîç',
          size: 'xl'
        }
      })
      
      const iconWrapper = container.querySelector('.icon-wrapper')
      expect(iconWrapper).toHaveClass('text-xl')
    })
  })
})
