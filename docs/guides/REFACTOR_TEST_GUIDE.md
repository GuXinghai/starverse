# ğŸ§ª åˆ†æ”¯æ ‘æ¶æ„é‡æ„ - å¿«é€Ÿæµ‹è¯•æŒ‡å—

## ğŸš€ å¯åŠ¨åº”ç”¨

```powershell
npm run dev
```

## ğŸ“‹ æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: åŸºç¡€å¯¹è¯æµå¼æ¸²æŸ“
**ç›®æ ‡**: éªŒè¯æµå¼ token è¿½åŠ å’Œ debounced save

1. æ‰“å¼€åº”ç”¨ï¼Œåˆ›å»ºæ–°å¯¹è¯
2. å‘é€æ¶ˆæ¯: "è¯·å†™ä¸€é¦–è¯—"
3. **éªŒè¯**:
   - âœ… AI å“åº”é€å­—æ˜¾ç¤ºï¼ˆæµå¼æ¸²æŸ“ï¼‰
   - âœ… æ§åˆ¶å°æ—  token ä¸¢å¤±é”™è¯¯
   - âœ… æ§åˆ¶å°æ˜¾ç¤º "âœ“ å¯¹è¯å·²ä¿å­˜" (ä»…åœ¨ç»“æŸåï¼Œéæ¯ä¸ª token)

### åœºæ™¯ 2: å¤šç‰ˆæœ¬ç”Ÿæˆä¸åˆ‡æ¢
**ç›®æ ‡**: éªŒè¯ç‰ˆæœ¬åˆ‡æ¢åè·¯å¾„è‡ªåŠ¨æ ¡æ­£

1. å‘é€æ¶ˆæ¯: "ä»‹ç»ä¸€ä¸‹é‡å­è®¡ç®—"
2. AI å›å¤åï¼Œç‚¹å‡» "é‡æ–°ç”Ÿæˆ" æŒ‰é’® 2-3 æ¬¡
3. ä½¿ç”¨ç‰ˆæœ¬åˆ‡æ¢æŒ‰é’® (â—€ â–¶) åˆ‡æ¢ç‰ˆæœ¬
4. **éªŒè¯**:
   - âœ… æ¯æ¬¡åˆ‡æ¢ç‰ˆæœ¬ï¼Œå†…å®¹ç«‹å³æ›´æ–°
   - âœ… æ§åˆ¶å°æ— è·¯å¾„é”™è¯¯
   - âœ… åˆ‡æ¢ç‰ˆæœ¬åç»§ç»­å¯¹è¯ï¼Œè·¯å¾„ä¿æŒæ­£ç¡®

### åœºæ™¯ 3: åˆ†æ”¯å¯¹è¯
**ç›®æ ‡**: éªŒè¯ç‰ˆæœ¬çº§åç»§å…³ç³»

1. å‘é€: "åˆ—ä¸¾ä¸‰ä¸ªç¼–ç¨‹è¯­è¨€"
2. AI å›å¤åï¼Œç‚¹å‡»æ¶ˆæ¯æ—çš„ "åˆ†æ”¯" æŒ‰é’®
3. åœ¨åˆ†æ”¯ä¸­å‘é€: "è¯¦ç»†ä»‹ç»ç¬¬ä¸€ä¸ª"
4. è¿”å›ä¸»åˆ†æ”¯ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬
5. **éªŒè¯**:
   - âœ… å­åˆ†æ”¯ä»…æ˜¾ç¤ºåœ¨å¯¹åº”çš„çˆ¶ç‰ˆæœ¬ä¸‹
   - âœ… åˆ‡æ¢çˆ¶ç‰ˆæœ¬åï¼Œé”™è¯¯çš„å­åˆ†æ”¯è¢«éšè—
   - âœ… è·¯å¾„æŒ‡ç¤ºå™¨æ˜¾ç¤ºæ­£ç¡®

### åœºæ™¯ 4: æŒä¹…åŒ–ä¸æ¢å¤
**ç›®æ ‡**: éªŒè¯ Map åºåˆ—åŒ–å’Œå“åº”å¼æ¢å¤

1. åˆ›å»ºå¤æ‚å¯¹è¯:
   - ä¸»åˆ†æ”¯: 3 æ¡æ¶ˆæ¯
   - ç¬¬ 2 æ¡æ¶ˆæ¯: 2 ä¸ªç‰ˆæœ¬
   - ç¬¬ 2 æ¡æ¶ˆæ¯çš„ç‰ˆæœ¬ 1: åˆ›å»ºå­åˆ†æ”¯
2. åˆ·æ–°é¡µé¢ (F5)
3. **éªŒè¯**:
   - âœ… æ‰€æœ‰æ¶ˆæ¯å®Œæ•´æ¢å¤
   - âœ… æ‰€æœ‰ç‰ˆæœ¬å®Œæ•´æ¢å¤
   - âœ… currentPath æ­£ç¡®æ¢å¤
   - âœ… ç‰ˆæœ¬åˆ‡æ¢ä»ç„¶å“åº”
   - âœ… æ§åˆ¶å°æ˜¾ç¤º "âœ“ æˆåŠŸåŠ è½½ X ä¸ªå¯¹è¯"

### åœºæ™¯ 5: åˆ†æ”¯åˆ é™¤
**ç›®æ ‡**: éªŒè¯çº§è”åˆ é™¤å’Œè·¯å¾„å›é€€

1. åœ¨æœ‰å­åˆ†æ”¯çš„æ¶ˆæ¯ä¸Šç‚¹å‡»åˆ é™¤
2. é€‰æ‹© "åˆ é™¤æ•´ä¸ªåˆ†æ”¯"
3. **éªŒè¯**:
   - âœ… å­æ ‘å®Œå…¨ç§»é™¤
   - âœ… currentPath å›é€€åˆ°çˆ¶åˆ†æ”¯
   - âœ… UI ç«‹å³æ›´æ–°
   - âœ… æ§åˆ¶å°æ— é”™è¯¯

### åœºæ™¯ 6: å¤šå›¾ç‰‡æ¶ˆæ¯
**ç›®æ ‡**: éªŒè¯å¤šæ¨¡æ€å†…å®¹çš„æµå¼å¤„ç†

1. ç‚¹å‡»å›¾ç‰‡æŒ‰é’®ï¼Œæ·»åŠ  2-3 å¼ å›¾ç‰‡
2. è¾“å…¥æ–‡æœ¬: "åˆ†æè¿™äº›å›¾ç‰‡"
3. å‘é€æ¶ˆæ¯
4. **éªŒè¯**:
   - âœ… å›¾ç‰‡æ­£ç¡®æ˜¾ç¤ºåœ¨æ¶ˆæ¯ä¸­
   - âœ… æ–‡æœ¬å’Œå›¾ç‰‡æ­£ç¡®ä¿å­˜
   - âœ… åˆ·æ–°åå›¾ç‰‡å’Œæ–‡æœ¬å®Œæ•´æ¢å¤

## ğŸ” å…³é”®è°ƒè¯•ç‚¹

### æ§åˆ¶å°æ—¥å¿—å…³é”®è¯

#### âœ… æ­£å¸¸æ—¥å¿—
```
âœ“ æˆåŠŸåŠ è½½ X ä¸ªå¯¹è¯
ğŸ”„ æ¢å¤å¯¹è¯ "xxx" çš„æ ‘å½¢ç»“æ„...
âœ“ å¯¹è¯å·²ä¿å­˜
```

#### âŒ éœ€è¦å…³æ³¨çš„é”™è¯¯
```
âŒ æ‰¾ä¸åˆ°åˆ†æ”¯
âŒ ä¿å­˜å¯¹è¯å¤±è´¥
âš ï¸ restoreTree: æ— æ³•è¯†åˆ«çš„ branches æ ¼å¼
```

### å¼€å‘è€…å·¥å…·æ£€æŸ¥

1. **Vue DevTools**:
   - æ£€æŸ¥ `chatStore.conversations[0].tree.branches` æ˜¯å¦æ˜¯ Map ç±»å‹
   - ä¿®æ”¹ç‰ˆæœ¬åï¼Œæ£€æŸ¥ç»„ä»¶æ˜¯å¦é‡æ–°æ¸²æŸ“

2. **Network**:
   - æ£€æŸ¥ API è°ƒç”¨æ˜¯å¦æ­£å¸¸
   - æµå¼å“åº”æ˜¯å¦æŒç»­

3. **Application > LocalStorage**:
   - æ£€æŸ¥ä¿å­˜çš„ conversations æ•°æ®ç»“æ„
   - branches åº”è¯¥æ˜¯æ•°ç»„æ ¼å¼ `[[key, value], ...]`

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜: ç‰ˆæœ¬åˆ‡æ¢å UI ä¸æ›´æ–°
**æ’æŸ¥**:
1. æ£€æŸ¥ `setBranch` æ˜¯å¦ä½¿ç”¨ `delete` + `set`
2. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨å±•å¼€æ“ä½œç¬¦åˆ›å»ºæ–°å¼•ç”¨
3. Vue DevTools ä¸­æ£€æŸ¥ reactive çŠ¶æ€

### é—®é¢˜: åˆ·æ–°åæ•°æ®ä¸¢å¤±
**æ’æŸ¥**:
1. æ£€æŸ¥ `serializeTree` æ˜¯å¦æ­£ç¡®è½¬æ¢ Map
2. æ£€æŸ¥ `restoreTree` æ˜¯å¦ä½¿ç”¨ `reactive(new Map())`
3. æŸ¥çœ‹ localStorage/electron-store ä¸­çš„åŸå§‹æ•°æ®

### é—®é¢˜: æµå¼æ¸²æŸ“å¡é¡¿
**æ’æŸ¥**:
1. æ£€æŸ¥ `appendTokenToBranchVersion` æ˜¯å¦ä½¿ç”¨ debounced save
2. æ£€æŸ¥æ˜¯å¦æœ‰åŒæ­¥çš„ saveConversations è°ƒç”¨
3. æŸ¥çœ‹ Network é¢æ¿æ˜¯å¦æœ‰é˜»å¡è¯·æ±‚

### é—®é¢˜: è·¯å¾„é”™è¯¯/åˆ†æ”¯è·³è½¬æ··ä¹±
**æ’æŸ¥**:
1. æ£€æŸ¥ `updatePathAfterVersionSwitch` é€»è¾‘
2. éªŒè¯ `child.parentVersionId === parentVersion.id`
3. æŸ¥çœ‹ currentPath æ•°ç»„å†…å®¹

## âœ… æµ‹è¯•é€šè¿‡æ ‡å‡†

- [ ] æ‰€æœ‰åœºæ™¯æ— æ§åˆ¶å°é”™è¯¯
- [ ] æ‰€æœ‰åœºæ™¯æ—  UI é—ªçƒ/å†»ç»“
- [ ] åˆ·æ–°åæ•°æ® 100% æ¢å¤
- [ ] ç‰ˆæœ¬åˆ‡æ¢å“åº”æ—¶é—´ < 100ms
- [ ] æµå¼æ¸²æŸ“æµç•…æ— å¡é¡¿
- [ ] åˆ†æ”¯æ“ä½œåè·¯å¾„æ­£ç¡®

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|------|----------|
| ç‰ˆæœ¬åˆ‡æ¢å»¶è¿Ÿ | < 100ms | DevTools Performance |
| Token è¿½åŠ å»¶è¿Ÿ | < 10ms | console.time |
| ä¿å­˜é¢‘ç‡ | â‰¤ 1æ¬¡/500ms | æ§åˆ¶å°æ—¥å¿—è®¡æ•° |
| é¡µé¢åŠ è½½æ¢å¤ | < 2s | è®¡æ—¶ |

---

**æµ‹è¯•å®Œæˆå**: åœ¨ BRANCH_TREE_REFACTOR_COMPLETE.md ä¸­æ›´æ–°æµ‹è¯•ç»“æœ âœ…
