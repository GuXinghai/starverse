# 推理功能交互优化

**日期**: 2025-12-03  
**类型**: UX 改进  
**组件**: `ReasoningControls.vue`

## 📋 改动内容

优化推理功能的操作逻辑，使交互更直观：

### 改动前

- 点击主按钮：打开挡位设置菜单
- 菜单内：选择挡位或点击"关闭推理"按钮

### 改动后 ✅

- **点击主按钮**：启用/关闭推理（toggle）
  - 第一次点击：启用推理（默认中挡）
  - 再次点击：关闭推理
- **点击下拉箭头**：打开挡位设置菜单
  - 选择极简/低/中/高四个档位
  - 选择后自动关闭菜单

## 🎨 视觉变化

### 未启用状态
```
[🧠 推理]  ← 灰色，点击启用
```

### 已启用状态
```
[🧠 推理 · 中 ▼]  ← 蓝色高亮，点击关闭，点击▼打开菜单
```

## 💻 技术实现

### 1. 主按钮逻辑

```typescript
// 切换推理启用/关闭状态
const handleToggleReasoning = () => {
  if (tier.value === 'off') {
    // 启用推理，默认使用中挡
    selectTier('medium')
  } else {
    // 关闭推理
    selectTier('off')
  }
}
```

### 2. 下拉箭头逻辑

```vue
<!-- 下拉箭头：点击打开菜单 -->
<svg 
  v-if="tier !== 'off'"
  @click.stop="toggleMenu"
>
  ...
</svg>
```

### 3. 菜单简化

- 移除了"关闭推理"按钮（功能已整合到主按钮）
- 保留四个档位选择按钮
- 选择档位后自动关闭菜单

## ✅ 优点

1. **操作更直观**：主按钮即开关，符合用户预期
2. **减少点击次数**：关闭推理从 2 步减少到 1 步
3. **状态更清晰**：按钮颜色直接表示启用/禁用状态
4. **保持灵活性**：挡位设置仍然方便访问

## 🧪 测试要点

- [ ] 未启用状态下点击主按钮，推理启用（默认中挡）
- [ ] 已启用状态下点击主按钮，推理关闭
- [ ] 已启用状态下点击下拉箭头，菜单打开
- [ ] 在菜单中选择挡位，菜单自动关闭且挡位更新
- [ ] 按钮颜色和状态正确显示（未启用=灰色，已启用=蓝色）
- [ ] Tooltip 提示正确（未启用："点击启用推理"，已启用："点击关闭推理（当前：X）"）

## 📝 相关文件

- `src/components/chat/controls/ReasoningControls.vue` - 主要修改
- `src/composables/useReasoningTiers.ts` - 使用的底层逻辑（未修改）
- `src/components/chat/input/ChatToolbar.vue` - 父组件（未修改）

## 🔄 兼容性

- ✅ 不影响现有 API
- ✅ 不改变数据存储格式
- ✅ 保持与 `useReasoningTiers` 的完全兼容
- ✅ 仅改变用户交互方式

---

**实现者**: GitHub Copilot  
**审核状态**: ⏳ 待测试
